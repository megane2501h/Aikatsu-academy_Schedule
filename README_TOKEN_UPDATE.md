# 🔄 Google Calendar API トークン更新ツール

GitHub Actionsのトークン期限切れ問題を簡単に解決するための自動化ツールです。

## 📋 使用方法

### Windows の場合
```cmd
# プロジェクトのルートディレクトリで実行
update_token.bat
```

### macOS/Linux の場合
```bash
# プロジェクトのルートディレクトリで実行
./update_token.sh
```

## 🎯 機能

### ✅ 自動化機能
- **トークン更新**: Google Calendar API認証の自動実行
- **状態確認**: 既存トークンの有効期限チェック
- **自動コピー**: 新しいトークンをクリップボードに自動コピー
- **ガイダンス**: GitHub Secrets更新の詳細手順表示

### 📊 表示情報
- 現在のディレクトリ確認
- 設定ファイルの存在確認
- 既存トークンファイルのサイズ
- 新しいトークンの有効期限
- スコープとリフレッシュトークンの状態

## 🚀 実行手順

### 1. 準備
```bash
# プロジェクトのルートディレクトリに移動
cd /path/to/Aikatsu-academy_Schedule

# config.ini が存在することを確認
ls config.ini
```

### 2. 実行
```bash
# Windows
update_token.bat

# macOS/Linux
./update_token.sh
```

### 3. ブラウザ認証
- ブラウザが開いてGoogleアカウントの認証画面が表示されます
- アカウントを選択して権限を許可してください
- 認証が完了すると自動的にトークンが生成されます

### 4. GitHub Secrets更新
1. 表示されたトークン内容をコピー
2. GitHubリポジトリの Settings > Secrets and variables > Actions
3. `GOOGLE_TOKEN` を選択して「Update」
4. コピーした内容を貼り付けて保存

## 🔧 トラブルシューティング

### よくある問題

**Q: ブラウザが開かない**
A: 手動でブラウザを開いて認証URLにアクセスしてください

**Q: 認証エラーが発生**
A: 
1. インターネット接続を確認
2. Googleアカウントのログイン状態を確認
3. config.ini の設定を確認

**Q: トークンファイルが生成されない**
A:
1. Python環境を確認: `python --version`
2. 依存関係を確認: `pip list | grep google`
3. 権限を確認: 書き込み権限があるか

**Q: 自動コピーが失敗**
A: 手動でトークン内容をコピーしてください

## 📁 ファイル構成

```
Aikatsu-academy_Schedule/
├── update_token.bat          # Windows用バッチファイル
├── update_token.sh           # macOS/Linux用シェルスクリプト
├── config.ini               # 設定ファイル
├── token.json               # 生成されるトークンファイル
└── src/main.py              # メイン処理
```

## 🎯 次のステップ

### 即座の解決
1. ツールを実行してトークンを更新
2. GitHub Secretsを更新
3. GitHub Actionsでテスト実行

### 根本的な解決
1. サービスアカウント認証への移行を検討
2. `docs/SERVICE_ACCOUNT_SETUP.md` を参照
3. 完全無人運用を実現

## 💡 ヒント

- **初回実行**: ブラウザ認証が必要です
- **再実行**: 既存のトークンがある場合は自動的にリフレッシュされます
- **セキュリティ**: 生成されたトークンは機密情報です。安全に管理してください
- **定期実行**: 月1回程度の実行でトークンを最新に保てます

## 🔄 自動化の進化

### レベル1: 手動更新（現在）
- 月1回の手動実行
- このツールで簡単化

### レベル2: 自動監視（推奨）
- `utils/token_monitor.py` で定期チェック
- 期限切れ前に自動アラート

### レベル3: 完全自動化（理想）
- サービスアカウント認証への移行
- 年1回のメンテナンスのみ

---

**🎉 このツールで「毎回手動更新」の煩わしさから解放されます！** 